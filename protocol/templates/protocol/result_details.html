{% extends "device/wrapper.html" %}

{% load i18n static %}

{% block content %}

<p>
    <a href="{% url 'testplan_details' pk=result.test.cat.testplan.id tab_id=2 %}">{% trans "Testplan" %} {{ result.test.cat.testplan }}</a> &raquo;
    {{ result.test.cat }} &raquo; <a href="{% url 'test_details' pk=result.test.id tab_id=1 %}">{{ num.0 }}.{{ num.1 }} {{ result.test.name }}</a>
    <br>
    <a href="{% url 'protocol_details' pk=result.protocol.id tab_id=2 %}">{% trans "Protocol" %} {{ result.protocol.device.vendor }} {{ result.protocol.device.model }}
    {% if result.protocol.device.hw %}({{result.protocol.device.hw }}){% endif %}</a>
</p>

<ul class="tabs" data-tabs id="result-tabs">
    <li class="tabs-title {% if tab_id == 1 %} is-active{% endif %}">
        <a data-tabs-target="general" href="#general">{% trans "General" %}</a>
    </li>
    <li class="tabs-title {% if tab_id == 2 %} is-active{% endif %}">
        <a data-tabs-target="details" href="#details">{% trans "Test Details" %}</a>
    </li>
    <li class="tabs-title{% if tab_id == 3 %} is-active{% endif %}">
        <a data-tabs-target="configs" href="#configs">{% trans "Configurations" %}
            {% if result.result_config.all.count > 0 %}({{ result.result_config.all.count }}){% endif %}
        </a>
    </li>
    <li class="tabs-title {% if tab_id == 4 %} is-active{% endif %}">
        <a data-tabs-target="result" href="#result">{% trans "Result" %}</a>
    </li>
    <li class="tabs-title {% if tab_id == 5 %} is-active{% endif %}">
        <a data-tabs-target="redmine" href="#redmine">Redmine</a>
    </li>
</ul>

<div class="tabs-content" data-tabs-content="result-tabs">
    <div class="tabs-panel{% if tab_id == 1 %} is-active{% endif %}" id="general">
        <a href="{% url 'result_update' pk=result.id %}" class="button small">{% trans "Update" %}</a>
        <a href="{% url 'result_delete' pk=result.id %}" class="button alert small">{% trans "Delete" %}</a>
        <table class="unstriped">
            <tbody>
            {% if result.redmine_wiki %}
            <tr>
                <td>{% trans "Redmine Wiki" %}:</td>
                <td>{{ result.redmine_wiki }}</td>
            </tr>
            {% endif %}
            <tr>
                <td>{% trans "Created" %}:</td>
                <td>{{ result.created_at }} {% if result.created_by %}({{ result.created_by }}){% endif %}</td>
            </tr>
            <tr>
                <td>{% trans "Last Update" %}:</td>
                <td>{{ result.updated_at }} {% if result.updated_by %}({{ result.updated_by }}){% endif %}</td>
            </tr>
            </tbody>
        </table>
    </div>

    <div class="tabs-panel{% if tab_id == 2 %} is-active{% endif %}" id="details">
        <div class="grid-x grid-margin-x">
            <div class="cell">
                <div class="card">
                    <div class="card-section">
                        <h5>{% trans "Procedure" %}</h5>
                        <p>{{ procedure|safe }}</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="grid-x grid-margin-x">
            <div class="cell">
                <div class="card">
                    <div class="card-section">
                        <h5>{% trans "Expected result" %}</h5>
                        <p>{{ expected|safe }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="tabs-panel{% if tab_id == 3 %} is-active{% endif %}" id="configs">
        <div class="grid-x grid-margin-x">
            <div class="cell">
                <div class="card">
                    <div class="card-section">
                        <a href="{% url 'result_config_create' result=result.id %}" class="button small">{% trans "Add" %}</a>
                        {% for config in result.result_config.all|dictsort:"id" %}
                        <p>
                            {% if config.desc %}{{ config.desc }}{% endif %}
                            <a href="{% url 'result_config_update' pk=config.id %}"><i class="step fi-pencil" style="color: #7700ff"></i></a>
                            <a href="{% url 'result_config_delete' pk=config.id %}"><i class="step fi-minus" style="color: red"></i></a>
                        </p>
                        <pre><code data-language="{{ config.lang }}">{{ config.config }}</code></pre>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="tabs-panel{% if tab_id == 4 %} is-active{% endif %}" id="result">
        <div class="grid-x grid-margin-x">
            <div class="cell">
                <div class="card">
                    <div class="card-section">
                        <form method="post" action="">
                            {% csrf_token %}
                            {{ result_form }}
                            <input type="submit" value='{% trans "Apply" %}' class="button success small" />
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="grid-x grid-margin-x">
            <div class="cell">
                <div class="card">
                    <div class="card-section">
                        <h4>{% trans "Issues" %}</h4>
                        <p><a href="{% url 'result_issue_create' result=result.id %}" class="button small">{% trans "Add" %}</a></p>
                        <ol>
                            {% for issue in result.result_issue.all|dictsort:"id" %}
                            <li>
                                {{ issue.text }}
                                <a href="{% url 'result_issue_update' pk=issue.id %}"><i class="step fi-pencil" style="color: #7700ff"></i></a>
                                <a href="{% url 'result_issue_delete' pk=issue.id %}"><i class="step fi-minus" style="color: red"></i></a>
                                {% if issue.ticket %}
                                <br><i><a href="{{ issue.ticket }}">{{ issue.ticket }}</a></i><br/>
                                {% endif %}
                            </li>
                            {% endfor %}
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="tabs-panel{% if tab_id == 5 %} is-active{% endif %}" id="redmine">
        {% if result.redmine_wiki %}
        <div class="grid-x grid-margin-x">
            <div class="cell">
                <div class="card">
                    <div class="card-section">
                        <h5>Redmine Project Wiki</h5>
                        <p>
                            <a href="{{ redmine_url }}/projects/{{ result.protocol.device.redmine_project }}/wiki/{{ result.redmine_wiki }}?parent={{ result.protocol.redmine_wiki }}">
                                {{ redmine_url }}/projects/{{ result.protocol.device.redmine_project }}/wiki/{{ result.redmine_wiki }}?parent={{ result.protocol.redmine_wiki }}
                            </a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        <div class="grid-x grid-margin-x">
            <div class="cell">
                <div class="card">
                    <div class="card-section">
                        <h5>{% trans "Export to" %} Redmine</h5>
                        <form action="{# url 'redmine_result_export' #}" method="post">
                            {% csrf_token %}
                            {{ export_form.as_p }}
                            <input type="submit" value='{% trans "Export" %}' class="button small success" />
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<script src="{% static 'rainbow/rainbow-custom.min.js' %}"></script>

{% endblock %}
