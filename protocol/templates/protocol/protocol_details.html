{% extends "device/wrapper.html" %}

{% load i18n static %}

{% block content %}

<p><a href="{% url 'protocols' %}">{% trans "Protocols" %}</a> &raquo; {{ protocol.device.vendor }} {{ protocol.device.model }} ({{ protocol.device.hw }})</p>

<ul class="tabs" data-tabs id="protocol-tabs">
    <li class="tabs-title {% if tab_id == 1 %} is-active{% endif %}">
        <a data-tabs-target="general" href="#general">{% trans "General" %}</a>
    </li>
    <li class="tabs-title {% if tab_id == 2 %} is-active{% endif %}">
        <a data-tabs-target="results" href="#results">{% trans "Results" %}</a>
    </li>
    <li class="tabs-title {% if tab_id == 3 %} is-active{% endif %}">
        <a data-tabs-target="statistics" href="#statistics">{% trans "Statistics" %}</a>
    </li>
    <li class="tabs-title {% if tab_id == 4 %} is-active{% endif %}">
        <a data-tabs-target="docx" href="#docx">{% trans "Docx" %}</a>
    </li>
    <li class="tabs-title {% if tab_id == 5 %} is-active{% endif %}">
        <a data-tabs-target="redmine" href="#redmine">{% trans "Redmine" %}</a>
    </li>
</ul>

<div class="tabs-content" data-tabs-content="protocol-tabs">

    <div class="tabs-panel {% if tab_id == 1 %}is-active{% endif %}" id="general">
        <a href="{% url 'protocol_update' pk=protocol.id %}" class="button small">{% trans "Update" %}</a>
        <a href="{% url 'protocol_delete' pk=protocol.id %}" class="button alert small">{% trans "Delete" %}</a>

        <div class="grid-x grid-margin-x">
            <div class="cell">
                <div class="card">
                    <div class="card-section">
                        <table class="unstriped">
                            <tr>
                                <td>ID:</td>
                                <td>{{ protocol.id }}</td>
                            </tr>
                            <tr>
                                <td>{% trans "Device" %}:</td>
                                <td>{{ protocol.device.vendor }} {{ protocol.device.model }} ({{ protocol.device.hw }})</td>
                            </tr>
                            <tr>
                                <td>{% trans "Software Version" %}:</td>
                                <td>{{ protocol.sw }}</td>
                            </tr>
                            <tr>
                                <td>{% trans "Checksum" %}:</td>
                                <td>{{ protocol.sw_checksum }}</td>
                            </tr>
                            <tr>
                                <td>{% trans "Engineer Login" %}:</td>
                                <td>{{ protocol.engineer_login }}</td>
                            </tr>
                            <tr>
                                <td>{% trans "Engineer Password" %}:</td>
                                <td>{{ protocol.engineer_password }}</td>
                            </tr>
                            <tr>
                                <td>{% trans "Started" %}:</td>
                                <td>{{ protocol.date_of_start }}</td>
                            </tr>
                            <tr>
                                <td>{% trans "Completed" %}:</td>
                                <td>{{ protocol.date_of_finish }}</td>
                            </tr>
                        </table>

                        {% if protocol.sysinfo %}
                        <div class="cell">
                            <div class="card">
                                <div class="card-section">
                                    <h5>{% trans "System Information" %}</h5>
                                    <p>{{ protocol.sysinfo|safe }}</p>
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        {% if protocol.console %}
                        <div class="cell">
                            <div class="card">
                                <div class="card-section">
                                    <h5>{% trans "Console port" %}</h5>
                                    <p>{{ protocol.console|safe }}</p>
                                </div>
                            </div>
                        </div>
                        {% endif %}

                    </div>
                </div>
            </div>
        </div>

    </div>

    <div class="tabs-panel {% if tab_id == 2 %}is-active{% endif %}" id="results">
        2
    </div>

    <div class="tabs-panel {% if tab_id == 3 %}is-active{% endif %}" id="statistics">
        3
    </div>

    <div class="tabs-panel {% if tab_id == 4 %}is-active{% endif %}" id="docx">
        4
    </div>

    <div class="tabs-panel {% if tab_id == 5 %}is-active{% endif %}" id="redmine">
        5
    </div>

</div>


<div class="grid-x">
    <div class="cell small-6">
        <p>
        <div class="grid-x">
            <div class="cell medium-6 large-4"><i>Версия HW:</i></div>
            <div class="cell medium-6 large-8">{{ protocol.device.hw }}</div>
        </div>
        <div class="grid-x">
            <div class="cell medium-6 large-4"><i>Версия ПО:</i></div>
            <div class="cell medium-6 large-8">{{ protocol.sw }}</div>
        </div>
        <div class="grid-x">
            <div class="cell medium-6 large-4"><i>Дата тестирования:</i></div>
            <div class="cell medium-6 large-8">{{ protocol.date_of_start|date:"d.m.Y" }} - {{ protocol.date_of_finish|date:"d.m.Y" }}</div>
        </div>
        </p>

        <ul class="dropdown menu" data-dropdown-menu>
            <li>
                <a href="/protocol/edit/{{ protocol.id }}/">Редактирование</a>
                <ul class="menu vertical">
                    <li><a href="/protocol/edit/{{ protocol.id }}/">Общая информация</a></li>
                    <li><a href="/protocol/inherit/{{ protocol.id }}/">Наследовать результаты</a></li>
                    <li><a href="/protocol/delete/{{ protocol.id }}/"><font color="red">Удалить протокол</font></a></li>
                </ul>
            </li>
            <li><a href="/protocol/export/{{ protocol.id }}/">Отправить в Redmine</a></li>
            <li>
                <a href="/testplan/">Word</a>
                <ul class="menu vertical">
                    <li><a href="/docx/protocol/create/{{ protocol.id }}">Протокол испытаний</a></li>
                    <li><a href="/docx/detailed_protocol/create/{{ protocol.id }}">Детализированный протокол (конфиги)</a></li>
                </ul>
            </li>
            <li>&nbsp;&nbsp;&nbsp;</li>
            <li><button onclick="hideCompleted()" id="hide_completed" class="button small rounded warning">
                Скрыть завершенные</button></li>
        </ul>

  </div>
    <div class="cell small-6">
        <div id="donutchart"></div>
    </div>
</div>

<table class="stack">
    <thead>
    <tr>
        <th width="50px">№</th>
        <th width="35%">Название теста:</th>
        <th width="110px">Результат:</th>
        <th>Комментарий:</th>
    </tr>
    </thead>
    <tbody>
    {% load static %}

    {% for result, num in zipped_results %}
    <tr {% if result.result != 0 %} class="completed" {% endif %}>
        <td onclick="window.location.href='/protocol/results/{{ result.id }}/'; return false">{{ num }}</td>
        <td onclick="window.location.href='/protocol/results/{{ result.id }}/'; return false">{{ result.test.name }}
        <br><span class="label secondary">{{ result.test.category }}</span></td>
        <td onclick="window.location.href='/protocol/results/{{ result.id }}/'; return false" align="center">
            {% if result.result == 0 %}
            <img src="{% static '/images/qu.png' %}" width="20" height="20">
            {% endif %}
            {% if result.result == 1 %}
            <img src="{% static '/images/nok.png' %}" width="25" height="25">
            {% endif %}
            {% if result.result == 2 %}
            <img src="{% static '/images/w_yellow.png' %}" width="25" height="25">
            {% endif %}
            {% if result.result == 3 %}
            <img src="{% static '/images/ok.png' %}" width="25" height="25">
            {% endif %}
        </td>
        <td onclick="window.location.href='/protocol/results/{{ result.id }}/'; return false">{{ result.comment }}</td>
    </tr>
    {% endfor %}

    </tbody>
</table>

<br>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load("current", {packages:["corechart"]});
      google.charts.setOnLoadCallback(drawChart);
      function drawChart() {
        var data = google.visualization.arrayToDataTable([
          ['Results', 'Percents'],
          ['Пройдено',     {{ tests_success }}],
          ['Пройдено с замечанием',      {{ tests_warn }}],
          ['Не пройдено',  {{ tests_fail }}],
		  ['Не тестировалось',  {{ tests_left }}],
        ]);

        var options = {
          title: 'My Daily Activities',

        };

        var chart = new google.visualization.PieChart(document.getElementById('donutchart'));


		chart.draw(data, {
		  title: 'Протестировано {{ tests_completed }} ({{ tests_completed_percent }}%) из {{ tests_all }}. Осталось: {{ tests_left }}',
		  width: 545,
		  height: 190,
		  pieHole: 0.2,
		  colors: ['green', 'orange', 'red', 'gray'],
		});
      }
</script>

<script>
    function hideCompleted() {
      var elements = document.getElementsByClassName('completed');

      var el = document.getElementById('hide_completed');
      if (el.firstChild.data == "Показать завершенные") {
        el.firstChild.data = "Скрыть завершенные";
      }
      else {
        el.firstChild.data = "Показать завершенные";
      }

      for (i = 0; i < elements.length; i++) {
        if (elements[i].style.display != 'none') {
          elements[i].style.display = 'none';
        }
        else {
          elements[i].style.display = 'table-row';
        }
	  }
    }
</script>

<script src="{% static 'js/my_datatables.js' %}"></script>

{% endblock %}
